# Linux 学习笔记（五）用户身份与文件权限

* 本笔记基于 刘遄 的《Linux 就该这么学》一书。
* 本章的主要内容将在最后总结。



## 用户身份与能力

* Linux 的设计初衷是满足多个用户同时工作的需求，因此 Linux 必须具备很好的安全性。
* root 是管理员，也是存在于所有类 UNIX 系统中的超级用户。它拥有最高的系统所有权，能管理系统所有功能，如添加/删除用户、启动/关闭服务进程、开启/禁用硬件设备等。
* 但 root 管理员的工作不受到系统的限制，因此执行了错误的命令可能直接毁掉整个系统。
* 这里我们依然希望直接以管理员身份进行学习更好，因为可以刚好地知道错误。



### 用户身份——UID

* 错误的结论：管理员就是 root。
* 管理员之所以是 root，并不是因为名字是 root，而是用户的身份号码（User IDentification，UID）的数值为 0。
* 用户身份有以下这些：
  * UID 为 0：系统的管理员用户。
  * UID 为 1~999：系统用户，Linux 系统为了避免因某个服务程序出现漏洞而被黑客提权至整台服务器，默认服务程序会有独立的系统用户负责运行，进而有效控制被破坏范围。
  * UID 为 1000 以上：普通用户，由管理员创建的用于日常工作的用户。
* 需要注意，UID 是不能冲突的，且即使有闲置号码，管理员创建的普通用户的 UID 也默认从 1000 开始。

#### 用户组

* 为了方便管理，Linux 还提供了用户组的概念。通过使用用户组号码（Group IDentification，GID），可把多个用户加入到同一组中，从而方便为组中的用户统一规划权限或指定任务。
  * 如公司有多个部门，每个部门有很多员工。则会指定让某个部门的员工只能访问这个部门的资源。
* 在创建用户时，Linux 系统将自动创建与其同名的基本用户组，而基本用户组只有该用户一个人。如果该用户之后被纳入其他用户组，则这个其他用户组称之为扩展用户组。一个用户只有一个基本用户组，但是可以有多个扩展用户组。



### useradd 命令

* useradd 命令用于创建新的用户。

#### 格式与用法

* useradd [选项] 用户名
* 创建用户时，默认的用户家目录会被存放在 /home 目录中，默认的 Shell 解释器为 /bin/bash，而且默认会创建一个与该用户同名的基本用户组。

#### 参数

* 可以通过参数来修改设置：

| 参数 | 作用                                      |
| ---- | ----------------------------------------- |
| -d   | 指定用户的家目录（默认为 /home/username） |
| -e   | 账户的到期时间，格式为 YYYY-MM-DD         |
| -u   | 指定该用户的默认 UID                      |
| -g   | 指定一个初始的基本用户组（必须已存在）    |
| -G   | 指定一个或多个扩展用户组                  |
| -N   | 不创建与用户同名的基本用户组              |
| -s   | 指定该用户的默认 Shell 解释器             |

#### 例子

* 下例创建一个普通用户并指定家目录的路径、用户的 UID 以及 Shell 解释器。
  * 请注意，/sbin/nologin 是一种终端解释器，与 Bash 解释器有天壤之别。一旦将用户的解释器设置为 nologin，则该用户不能登录到系统中。

```shell
useradd -d /home/linux -u 8888 -s /sbin/nologin linuxprobe
id linuxprobe
```

[]



### groupadd 命令

* groupadd 命令用于创建用户组。

#### 格式

* groupadd [选项] 群组名

#### 用法

* 工作中常常把几个用户加入到同一个组里面，这样可以针对一类用户统一安排权限。
* 下面是一个创建 ronny 用户组的例子：

```shell
groupadd ronny
```

[]



### usermod 命令

* usermod 命令用于修改用户属性。

#### 格式与用法

* usermod [选项] 用户名
* 由于在系统中创建用户也是修改配置文件的过程，信息保存在 /etc/passwd 文件中，可直接用文本编辑器来修改用户参数数目，
* 也可以用 usermod 命令也可以修改用户信息，诸如用户的 UID、基本/扩展用户组、默认终端等。

#### 参数

* usermod 命令的参数及作用：

| 参数  | 作用                                                         |
| ----- | ------------------------------------------------------------ |
| -c    | 填写用户账户的备注信息                                       |
| -d -m | 参数 -m 与参数 -d 连用，可重新指定用户的家目录并自动把旧的数据转移过去 |
| -e    | 账户的到期时间，格式为 YYYY-MM-DD                            |
| -g    | 变更所属用户组                                               |
| -G    | 变更扩展用户组                                               |
| -L    | 锁定用户禁止其登录系统                                       |
| -U    | 解锁用户，允许其登录系统                                     |
| -s    | 变更默认终端                                                 |
| -u    | 修改用户的 UID                                               |

#### 例子

* 查看账户 linuxprobe 的默认信息：

```shell
id linuxprobe
```

* 将用户 linuxprobe 加入到 root 用户组中，这样扩展组列表中会出现 root 用户组：

```shell
usermod -G root linuxprobe
id linuxprobe
```

* 下面用 -u 参数修改 linuxprobe 的 UID 号码值。
  * 还可以用 -g 参数修改用户的基本组 ID，用 -G 参数修改用户扩展组 ID。

```shell
usermod -u 8888 linuxprobe
id linuxprobe
```

[]



### passwd 命令

* passwd 命令用于修改用户密码、过期时间、认证信息等。

#### 格式与用法

* passwd [选项] [用户名]
* **普通用户**只能使用 passwd 命令修改自身的系统密码，而 root 管理员则**有权限修改其他所有人的密码**。更酷的是，root 管理员在Linux系统中修改自己或他人的密码时**不需要验证旧密码**，这一点特别方便。
* 既然 root 管理员可以修改其他用户的密码，就表示完全拥有该用户的管理权限。

#### 参数

* passwd 命令的参数及作用如下：

| 参数    | 作用                                                         |
| ------- | ------------------------------------------------------------ |
| -l      | 锁定用户，禁止其登录                                         |
| -u      | 解除锁定，允许用户登录                                       |
| --stdin | 允许通过标准输入修改用户密码，如 echo "NewPassWord" \| passwd --stdin Username |
| -d      | 使该用户可用空密码登录系统                                   |
| -e      | 强制用户在下次登录时修改密码                                 |
| -S      | 显示用户的密码是否被锁定，以及密码所采用的加密算法名称       |

#### 例子

* 下面演示如何修改用户自己的密码，以及如何修改其他人的密码（需要 root 权限）：

```shell
passwd # 修改root密码
# 输入密码值
# 再次输入确认
passwd linuxprobe
# 输入密码值
# 再次输入确认
```

[]

* 如果某用户长期不登录，可以使用 passwd 命令禁止用户登录系统，而不是删除。

```shell
passwd -l linuxprobe
passwd -S linuxprobe
passwd -u linuxprobe
passwd -S linuxprobe
```

[]



### userdel 命令

* userdel 命令用于删除用户。

#### 格式与用法

* userdel [选项] 用户名
* 通过userdel命令删除该用户的所有信息。在执行删除操作时，该用户的**家目录默认会保留**下来，此时可以使用 -r 参数将其删除。

#### 参数

* userdel 命令参数如下所示：

| 参数 | 作用                     |
| ---- | ------------------------ |
| -f   | 强制删除用户             |
| -r   | 同时删除用户及用户家目录 |

#### 例子

* 使用 userdel 命令将 linuxprobe 用户删除：

```shell
id linuxprobe
userdel -r linuxprobe
id linuxprobe
```

【】





## 文件权限与归属

### 文件类型与权限简介

#### 文件类型

* 尽管在 Linux 系统中一切都是文件，但是每个文件的类型不尽相同：
  * 因此 Linux 系统使用了不同的字符来加以区分，常见的字符如下所示。

| 字符 | 文件类型     |
| ---- | ------------ |
| -    | 普通文件     |
| d    | 目录文件     |
| l    | 链接文件     |
| b    | 块设备文件   |
| c    | 字符设备文件 |
| p    | 管道文件     |

#### 文件权限

* 在 Linux 系统中，每个文件都有所属的所有者和所有组，并且规定了文件的所有者、所有组以及其他人对文件所拥有的**可读**（r）、**可写**（w）、**可执行**（x）等权限。
* 对一般文件来说：
  * “可读” 表示能够读取文件的实际内容；
  * “可写” 表示能够编辑、新增、修改、删除文件的实际内容；
  * “可执行” 表示能够运行一个脚本程序。
* 重点：而对于目录文件来说：
  * “可读” 表示能够读取目录内的文件列表；
  * “可写” 表示能够在目录内新增、删除、重命名文件；
  * “可执行” 则表示能够进入该目录。



### 文件权限的表示

* 文件的读、写、执行权限可以简写为 rwx，亦可分别用数字 421 表示。
* 文件**所有者**，**所属组**及**其他用户**权限之间**无关联**。

#### 表示的意义

* 文件权限的数字法表示基于字符表示（rwx）的权限计算而来，其目的是简化权限的表示。
* 例如，若某个文件的权限为 **7** 则代表可读、可写、可执行（4+2+1）。
* 又例如，现在有这样一个文件，其所有者拥有**可读、可写、可执行**的权限，其文件所属组拥有**可读、可写**的权限；而且其他人只有**可读**的权限。那么，这个文件的权限就是 **rwxrw-r--**，数字法表示即为 **764**。由于这三者之间没有互通关系，所以不能写成 17。

#### 分析文件信息

* 下面分析下图所示的文件信息：

```shell
ls -l install.log
```

[]

图中，

