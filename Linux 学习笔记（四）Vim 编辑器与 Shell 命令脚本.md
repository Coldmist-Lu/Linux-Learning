# Linux 学习笔记（四）Vim 编辑器与 Shell 命令脚本

* 本笔记基于 刘遄 的《Linux 就该这么学》一书。
* 本章将首先介绍。。。正在制作中。
* 需要注意，本笔记排版与原书的介绍顺序有所不同，会将**理论内容放在前面**讲解，**实践内容放在最后**。
  * 当理论内容介绍完毕，笔记会加以注释参看相关实践内容。



## Vim 文本编辑器

* 在 Linux 系统中一切都是文件，而配置一个服务就是在**修改其配置文件的参数**。
* 在日常工作中也免不了要编写文件，这些工作都是通过**文本编辑器**完成的。
* 选择使用 Vim 文本编辑器来完成，它默认安装在所有的 Linux 系统上，是一款超棒的文本编辑器。
* 下面我们边介绍 Vim 编辑器的用法，边体会 Vim 编辑器的特色。



### 三种模式

* Vim 编辑器设置了三种模式——命令模式、末行模式和编辑模式。每种模式也支持多种不同的快捷键，可实现高效操作文本。

#### 模式作用

* 命令模式：控制光标移动，可对文本进行复制、粘贴、删除和查找等工作。
* 输入模式：正常的文本录入。
* 末行模式：保存或退出文档，以及设置编辑环境。

#### 模式切换

* 每次运行 Vim 文本编辑器时，**默认进入命令模式**。输入模式和末行模式都必须通过命令模式进入（换句话说，不能直接从输入模式到末行模式，也不能直接从末行模式到输入模式）。
* 出命令模式：按 a, i, o 等键可进入输入模式，按 : 键可进入末行模式。
* 返回命令模式：无论出于哪个模式，按 Esc 键即返回命令模式。
* 可以认为，命令模式是一个主菜单，而输入和末行模式是两个子菜单。必须从主菜单进入子菜单，从子菜单返回主菜单。



### 常用命令

#### 命令模式

* 下表总结了在命令模式下的常用命令：

| 命令 | 作用                                               |
| ---- | -------------------------------------------------- |
| dd   | 删除（剪切）光标所在整行                           |
| 5dd  | 删除（剪切）从光标处开始的 5 行                    |
| yy   | 复制光标所在整行                                   |
| 5yy  | 复制从光标处开始的 5 行                            |
| n    | 显示搜索命令定位到的下一个字符串                   |
| N    | 显示搜索命令定位到的上一个字符串                   |
| u    | 撤销上一步的操作                                   |
| p    | 将之前删除（dd）或复制（yy）过的数据粘贴到光标后面 |

#### 末行模式

* 末行模式主要用于保存或退出文件，以及设置 Vim 编辑器的工作环境，还可以让用户执行外部的 Linux 命令或跳转到所编写文档的特定行数。切换到末行模式用冒号（：）就可以。
* 下表总结了在末行模式下的常用命令：（这里默认是从命令模式开始输入的）

| 命令          | 作用                                    |
| ------------- | --------------------------------------- |
| :w            | 保存                                    |
| :q            | 退出                                    |
| :q!           | 强制退出（放弃对文档的修改内容）        |
| :wq!          | 强制保存退出                            |
| :set nu       | 显示行号                                |
| :set nonu     | 不显示行号                              |
| :命令         | 执行该命令                              |
| :整数         | 跳转到该行                              |
| :s/one/two    | 将当前光标所在行的第一个 one 替换成 two |
| :s/one/two/g  | 将当前光标所在行的所有 one 替换成 two   |
| :%s/one/two/g | 将全文中的所有 one 替换成 two           |
| ?字符串       | 在文本中从下至上搜索该字符串            |
| /字符串       | 在文本中从上至下搜索该字符串            |



### 配置主机名称

* 为便于在局域网中查找特定的主机，或对主机进行区分，除要有 IP 地址外，还要为主机配置一个主机名，主机之间通过这个类似于域名的名称来互相访问。
* 在 Linux 系统中，主机名大多保存在 /etc/hostname 文件中，接下来将 /etc/hostname 文件的内容修改为 "linuxprobe.com":

#### 步骤

* 使用 Vim 编辑器修改 "/etc/hostname" 主机名称文件。
* 把原始主机名称删除后追加 "linuxprobe"。
  * 注意：Vim 修改主机名称文件后，要执行 :wq! 命令才能保存退出。
* 保存并退出文档，使用 hostname 命令检查是否修改成功。

#### 例子

* 原来 hostname 为 linuxprobe.com，修改为 linuxprobe。

```shell
vim /etc/hostname
# 进入编辑器，按i进入编辑，删除原名字（linuxprobe.com），增加linuxprobe，按Esc，输入:wq!退出
hostname
```

![8](Linux_4_pic/8.png)



### 配置网卡信息

* 网卡 IP 地址配置是否正确是两台服务器是否可以相互通信的前提。在 Linux 系统中，一切都是文件，因此配置网络服务就是在编辑网卡配置文件。
* 在早期 Linux 系统中，如 RHEL 5、RHEL 6 中，网卡配置文件的前缀为 eth，第 1 块网卡为 eth0，第 2 块网卡为 eth1；以此类推。
* 而 RHEL 7 中，网卡配置文件的前缀以 ifcfg 开始，加上网卡名称共同组成了配置文件名，例如 ifcfg-eno16777736。
* 本节任务是，将网卡设备配置为开机自启动，并且 IP 地址、子网、网关等信息由人工指定。

#### 步骤

* 切换到 /etc/sysconfig/network-scripts 目录中（存放网卡配置文件）；
* 使用 Vim 编辑器修改网卡文件 ifcfg-eno16777736，逐项写入下面的配置参数，然后保存退出。
  * 由于每台设备的硬件及架构是不一样的，因此请读者使用 ifconfig 命令自行确认各自网卡的默认名称。
  * 需要写入的参数：
  * 设备类型：TYPE=Ethernet
  * 地址分配模式：BOOTPROTO=static
  * 网卡名称：NAME=eno16777736
  * 是否启动：ONBOOT=yes
  * IP 地址：IPADDR=192.168.10.10
  * 子网掩码：NETMASK=255.255.255.0
  * 网关地址：GATEWAY=192.168.10.1
  * DNS 地址：DNS1=192.168.10.1
* 重启网络服务并测试网络是否连通。

#### 例子

* 下面展示了修改网卡的步骤。需要修改 BOOTPROTO、ONBOOT 参数，增添 IPADDR、NETMASK、GATEWAY、DNS1 四个参数。

```shell
cd /etc/sysconfig/network-scripts/
ls
vim ifcfg-eno16777728
# 修改内容（见下图1）
systemctl restart network
ping 192.168.10.10
^C # 终止ping
```

* ifcfg-eno16777728 文件编辑：

![9](Linux_4_pic/9.png)

* Command：

![10](Linux_4_pic/10.png)



### 配置 Yum 软件仓库

* Yum 软件仓库的作用是为了进一步简化 RPM 管理软件的难度以及自动分析所需软件包以及依赖关系。
* 具体存储以及设备挂载的操作要在第 6 章才会讲解，因此本章重心是学习 Vim 编辑器。

#### 步骤

* 进入到 /etc/yum.repos.d/ 目录中（该目录存放配置文件）。
* 使用 Vim 编辑器创建一个名为 rhel7.repo 的新配置文件（文件名随意，但后缀名必须为 .repo），逐项写入下面的配置参数。（写加粗部分，不写后面的注释）：
  * **[rhel-media]**：Yum 软件仓库唯一标识符，避免与其他仓库冲突。
  * **name=linuxprobe**：Yum 软件仓库的名称描述，易于识别仓库用处。
  * **baseurl=file:///media/cdrom**：提供的方式包括 FTP（ftp://..）、HTTP（http://..）、本地（file:///..）。
  * **enabled=1**：设置此源是否可用；1为可用，0为禁用。
  * **gpgcheck=1**：设置此源是否校验文件；1为校验，0为不校验。
  * **gpgkey=file:///media/cdrom/RPM-GPG-KEY-redhat-release**：若上面参数开启校验，需要执行校验公钥文件地址。

* 按配置参数的路径挂载光盘，并把光盘挂载信息写入到 /etc/fstab 文件中。
* 使用 "yum install httpd -y" 命令检查 Yum 软件仓库是否已经可用。

#### 例子

* 下面展示 Yum 配置的例子：

```shell
cd /etc/yum.repos.d/
vim rhel7.repo
mkdir -p /media/cdrom
mount /dev/cdrom /media/cdrom
vim /etc/fstab
yum install httpd
# ... Complete!
```

* rhel7.repo 文件编辑：

![12](Linux_4_pic/12.png)

* /etc/fstab 文件编辑：

![13](Linux_4_pic/13.png)

* Command：

![14](Linux_4_pic/14.png)



## 编写 Shell 脚本





## Vim 编写简单文档

* 本部分我们尝试编写一个简单的脚本文档。

### 新建文件

* 采用 "vim 文件名" 的命令格式可以新建一个文档。如果该文件名已存在，则会**打开已有文档**，否则**创建一个临时输入文件**。

```shell
vim practice.txt
```

![1](Linux_4_pic/1.png)

* 进入文件后会首先进入编辑器的命令模式，按 a, i, o 三个键都可以进入输入模式。
  * a 键会将光标移动到后面一位；
  * i 键会将光标移动到当前位置；
  * o 键会在下面新建一个空行，并移动到那个位置。
* 这里假设我们已经在编辑状态下写了如下的内容，并将指针停在如下位置：
  * 那么 a 键、i 键、o 键按下后的位置就如下面的红色框中所示。

![2](Linux_4_pic/2.png)

* 下面就可以尽情地写文本了。
* 第一次我们在空白文档内输入 "You can write in it."，然后按 Esc 键回到命令模式，输入 ":wq!" 强制保存退出。
  * 最后在命令行使用 cat 语句查看文本内容：

![3](Linux_4_pic/3.png)

![4](Linux_4_pic/4.png)

* 接下来在原文档后面追加 "This Sentence don't need to save"，然后按 Esc 键回到命令模式，输入 ":q" 不保存退出。
  * 系统会先询问是否覆写，所以必须加 ! 来强制退出。
  * 最后在命令行使用 cat 语句查看文本内容，发现内容没有修改：

![5](Linux_4_pic/5.png)

![6](Linux_4_pic/6.png)

![7](Linux_4_pic/7.png)

* 这就是简单的 vim 命令的使用。